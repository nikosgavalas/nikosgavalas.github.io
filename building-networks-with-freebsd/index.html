<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="color-scheme" content="light dark">

    
      <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/ https://cdnjs.cloudflare.com; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">

    

    
    <meta name="description" content="Well the title is pretty self-explanatory. This is not a tutorial though, just a reference point with examples for implementing and debugging network architectures with FreeBSD and Quagga.
Note about notation: to indicate shell commands I&rsquo;ll be using $, and for quagga commands #.
FreeBSD System Configuration in /etc/rc.conf. Instead of directly editing the file it&rsquo;s better to use sysrc.
rc.conf - sysrc Enable packet forwarding (act as gateway)
$ sysrc gateway_enable=&#34;YES&#34; Set hostname (kept after reboot):">
    <meta name="keywords" content="">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Building networks with FreeBSD"/>
<meta name="twitter:description" content="Well the title is pretty self-explanatory. This is not a tutorial though, just a reference point with examples for implementing and debugging network architectures with FreeBSD and Quagga.
Note about notation: to indicate shell commands I&rsquo;ll be using $, and for quagga commands #.
FreeBSD System Configuration in /etc/rc.conf. Instead of directly editing the file it&rsquo;s better to use sysrc.
rc.conf - sysrc Enable packet forwarding (act as gateway)
$ sysrc gateway_enable=&#34;YES&#34; Set hostname (kept after reboot):"/>

    <meta property="og:title" content="Building networks with FreeBSD" />
<meta property="og:description" content="Well the title is pretty self-explanatory. This is not a tutorial though, just a reference point with examples for implementing and debugging network architectures with FreeBSD and Quagga.
Note about notation: to indicate shell commands I&rsquo;ll be using $, and for quagga commands #.
FreeBSD System Configuration in /etc/rc.conf. Instead of directly editing the file it&rsquo;s better to use sysrc.
rc.conf - sysrc Enable packet forwarding (act as gateway)
$ sysrc gateway_enable=&#34;YES&#34; Set hostname (kept after reboot):" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nikosg.com/building-networks-with-freebsd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-06-25T00:00:00+00:00" />


    <title>
  Building networks with FreeBSD Â· Nikos Gavalas
</title>

    
      <link rel="canonical" href="https://nikosg.com/building-networks-with-freebsd/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.708686f8ab8176e91d44fcbe488a0fe0333b94f405cf18a52383d67ba22f0ccb.css" integrity="sha256-cIaG&#43;KuBdukdRPy&#43;SIoP4DM7lPQFzxilI4PWe6IvDMs=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css" integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin="anonymous" media="screen" />
      
    

    
      <link rel="stylesheet" href="/css/custom.css" />
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/styles/default.min.css" />
    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    

    <meta name="generator" content="Hugo 0.111.3">
  </head>

  
  
    
  
  <body class="preload-transitions colorscheme-auto"
        onload=""
  >
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Nikos Gavalas
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Posts</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://nikosg.com/building-networks-with-freebsd/">
              Building networks with FreeBSD
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2018-06-25T00:00:00Z'>
                June 25, 2018
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              10-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa fa-folder" aria-hidden="true"></i>
    <a href="/categories/networking/">networking</a></div>

          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/networking/">networking</a>
    </span></div>

        </div>
      </header>

      <div>
        
        <p>Well the title is pretty self-explanatory. This is not a tutorial though, just a reference point with examples for implementing and debugging network architectures with <a href="https://www.freebsd.org/">FreeBSD</a> and <a href="https://www.quagga.net/">Quagga</a>.</p>
<p><strong>Note</strong> about notation: to indicate shell commands I&rsquo;ll be using <code>$</code>, and for quagga commands <code>#</code>.</p>
<hr>
<h2 id="freebsd">
  FreeBSD
  <a class="heading-link" href="#freebsd">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>System Configuration in <code>/etc/rc.conf</code>.
Instead of directly editing the file it&rsquo;s better to use <code>sysrc</code>.</p>
<h3 id="rcconf---sysrc">
  rc.conf - sysrc
  <a class="heading-link" href="#rcconf---sysrc">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Enable packet forwarding (act as gateway)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sysrc gateway_enable=&#34;YES&#34;
</span></span></code></pre></div><p>Set hostname (kept after reboot):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sysrc hostname=&#34;router.example.com&#34;
</span></span></code></pre></div><p>Configure interfaces:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sysrc ifconfig_em0=&#34;inet 10.10.10.100 netmask 255.255.255.0&#34;
</span></span><span style="display:flex;"><span>$ sysrc ifconfig_em1=&#34;DCHP&#34; # aquire address from DHCP
</span></span></code></pre></div><p>Set gateway 10.10.10.100:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sysrc defaultrouter=&#34;10.10.10.100&#34;
</span></span></code></pre></div><h3 id="ifconfig">
  ifconfig
  <a class="heading-link" href="#ifconfig">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Activate/Deactivate interface em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig em0 up/down
</span></span></code></pre></div><p>Specify address 192.168.1.1, netmask 255.255.255.0 and broadcast address 192.168.1.255 on em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig em0 192.168.1.1 netmask 255.255.255.0 broadcast 192.168.1.255
</span></span></code></pre></div><p>Quicker way:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig em0 192.168.1.1/24
</span></span></code></pre></div><p>Delete address from interface em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig em0 delete
</span></span></code></pre></div><h3 id="dhclient">
  dhclient
  <a class="heading-link" href="#dhclient">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Activate DHCP client on interface em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ dhclient em0
</span></span></code></pre></div><h3 id="tcpdump">
  tcpdump
  <a class="heading-link" href="#tcpdump">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<h4 id="useful-flags">
  Useful flags
  <a class="heading-link" href="#useful-flags">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<ul>
<li><code>-i any</code> : Listen on all interfaces</li>
<li><code>-i em0</code> : Listen on interface em0</li>
<li><code>-n</code> : Don&rsquo;t resolve hostnames</li>
<li><code>-t</code> : Human-readable timestamp output</li>
<li><code>-tttt</code> : Maximally human-readable timestamp output</li>
<li><code>-A</code> : Packet contents in ascii</li>
<li><code>-X</code> : Show packets contents in both hex and ascii</li>
<li><code>-v, -vv, -vvv</code> : Verbosity</li>
<li><code>-e</code> : Show ethernet header too</li>
<li><code>-S</code> : Absolute sequence numbers</li>
</ul>
<h4 id="expressions">
  Expressions
  <a class="heading-link" href="#expressions">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<p>Useful keywords are:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Keyword</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>host</code></td>
<td style="text-align:left">All traffic associated with specified host</td>
</tr>
<tr>
<td style="text-align:center"><code>net</code></td>
<td style="text-align:left">All traffic associated with specified network</td>
</tr>
<tr>
<td style="text-align:center"><code>port</code></td>
<td style="text-align:left">All traffic associated with specified port</td>
</tr>
<tr>
<td style="text-align:center"><code>src</code></td>
<td style="text-align:left">Traffic source</td>
</tr>
<tr>
<td style="text-align:center"><code>dst</code></td>
<td style="text-align:left">Traffic destination</td>
</tr>
<tr>
<td style="text-align:center"><code>tcp</code></td>
<td style="text-align:left">Protocol TCP</td>
</tr>
<tr>
<td style="text-align:center"><code>udp</code></td>
<td style="text-align:left">Protocol UDP</td>
</tr>
<tr>
<td style="text-align:center"><code>icmp</code></td>
<td style="text-align:left">Protocol ICMP</td>
</tr>
</tbody>
</table>
<p>Combine the keywords with <code>and</code> (or <code>&amp;&amp;</code>), <code>or</code> (or <code>||</code>), <code>not</code> (or <code>!</code>).</p>
<h4 id="files">
  Files
  <a class="heading-link" href="#files">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<p>Write output to PCAP file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ tcpdump -w pcap_file
</span></span></code></pre></div><p>Read PCAP file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ tcpdump -r pcap_file
</span></span></code></pre></div><h4 id="examples">
  Examples
  <a class="heading-link" href="#examples">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<p>No hostnames/ports resolution, be very verbose, use absolute sequence numbers and show traffic coming from host 10.5.2.3 and has destination the port number 3389:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ tcpdump -nnvvvS src 10.5.2.3 and dst port 3389
</span></span></code></pre></div><p>No hostname/ports resolution, show ethernet header, and display all packets that either use the udp protocol or they come from host 192.168.1.2 and go to network 192.168.1.0/24:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ tcpdump -nne &#39;udp or (src 192.168.1.2 and dest net 192.168.1.0/24)&#39;
</span></span></code></pre></div><h3 id="netstat">
  netstat
  <a class="heading-link" href="#netstat">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Show active connections without name resolution:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ netstat -an
</span></span></code></pre></div><p>Show routing table without name resolution:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ netstat -rn
</span></span></code></pre></div><hr>
<h2 id="lans">
  LANs
  <a class="heading-link" href="#lans">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="arp">
  ARP
  <a class="heading-link" href="#arp">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>View arp table</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ arp -a
</span></span></code></pre></div><p>Clear arp table</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ arp -d -a
</span></span></code></pre></div><h3 id="bridges">
  Bridges
  <a class="heading-link" href="#bridges">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Create/Destroy a network pseudo-device bridge called bridgeX where X=0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 create/destroy
</span></span></code></pre></div><p>Add as members the interface em0, em1, em2 and enable bridge0 (run ifconfig em0 up etc first):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 addm em0 addm em1 addm em2 up 
</span></span></code></pre></div><p>Remove interface em0 from bridge0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 deletem em0 
</span></span></code></pre></div><p>View the addresses that bridge0 has learned and associated ports:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 addr 
</span></span></code></pre></div><p>Clear addresses that have been learned dynamically:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 flush 
</span></span></code></pre></div><p>Enable the STP protocol on interfaces em0, em1, em2 of bridge bridge0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 stp em0 stp em1 stp em2 
</span></span></code></pre></div><p>Disable the STP protocol on interfaces em0, em1, em2 of bridge bridge0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 -stp em0 -stp em1 -stp em2 
</span></span></code></pre></div><p>Set priority value for bridge bridge0 (default value is 32768, minimum 0 and maximum is 61440):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 priority value 
</span></span></code></pre></div><p>Set priority value for interface em0 of bridge bridge0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 ifpriority em0 &lt;value&gt;
</span></span></code></pre></div><p>Set cost for path through em0 of bridge bridge0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig bridge0 ifpathcost em0 &lt;value&gt; 
</span></span></code></pre></div><h3 id="link-aggregation">
  Link aggregation
  <a class="heading-link" href="#link-aggregation">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Create a network pseudo-device for aggregating links, called laggX, where X=0 for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig lagg0 create 
</span></span></code></pre></div><p>Add interface em0 to lagg0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig lagg0 laggport em0
</span></span></code></pre></div><p>Remove interface em0 from lagg0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig lagg0 -laggport em0
</span></span></code></pre></div><p>Specify aggregation protocol (default value is failov):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig lagg0 laggproto proto
</span></span></code></pre></div><h3 id="vlans">
  VLANs
  <a class="heading-link" href="#vlans">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Create pseudo-interface VLAN based on interface em0, that belongs to vlan with vlan_tag=5, and assign IP address 192.168.20.20/24:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig em0.5 create vlan 5 vlandev em0 inet 192.168.20.20/24
</span></span></code></pre></div><p>Create only the pseudo-interface with vlan_tag=5:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig em0.5 create
</span></span></code></pre></div><hr>
<h2 id="routing-basics">
  Routing Basics
  <a class="heading-link" href="#routing-basics">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Enable packet forwarding:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ systcl net.inet.ip.forwarding=1
</span></span></code></pre></div><p>Enable proxy ARP</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sysctl net.link.ether.inet.proxyall=1
</span></span></code></pre></div><p>View system routing table:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ netstat -r
</span></span></code></pre></div><p>Add default route:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ route add default 192.168.1.1
</span></span></code></pre></div><p>Add route to network 192.168.0.0/16 through gateway 192.168.1.1</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ route add -net 192.168.0.0/16 192.168.1.1
</span></span></code></pre></div><p>Add route to host 192.168.1.2 through gateway 192.168.1.1</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ route add -host 192.168.1.2 192.168.1.1
</span></span></code></pre></div><p>Change gateway for already defined route to network 192.168.0.0/16:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ route change -net 192.168.0.0/16 192.168.2.1
</span></span></code></pre></div><p>Show route for specified destination</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ route show &lt;destination&gt;
</span></span></code></pre></div><p>Delete route for destination</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ route del &lt;destination&gt;
</span></span></code></pre></div><p>Delete all routes</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ route flush
</span></span></code></pre></div><hr>
<h2 id="firewall-ipfw">
  Firewall (ipfw)
  <a class="heading-link" href="#firewall-ipfw">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Enable by loading the corresponding kernel module:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ kldload ipfw
</span></span></code></pre></div><p>Add ipfw rule:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ipfw add rule_number action proto from src src_port to dst dst_port options
</span></span></code></pre></div><p>, where:</p>
<ul>
<li>rule_number: The sequence number of the rule (value in range 1-65535)</li>
<li>action: can be <code>allow</code>, <code>deny</code>, or <code>check-state</code></li>
<li>proto: <code>ip4</code>, <code>ip6</code>, <code>all</code> for any protocol, etc</li>
<li>src: source address</li>
<li>src_port: source port</li>
<li>dst: destination address</li>
<li>dst_port: destination port</li>
<li>options: <code>in</code> or <code>out</code> for direction, <code>via</code> to specify interface, <code>icmptypes &lt;type&gt;</code>, <code>keep-state</code> (which will create a dynamic rule to allow bi-directional communication for matching protocol and port), and more.</li>
</ul>
<p>Show ipfw rules:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ipfw show
</span></span></code></pre></div><p>Flush all rules:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ipfw flush
</span></span></code></pre></div><h3 id="nat-in-kernel-on-ipfw">
  NAT (in-kernel, on ipfw)
  <a class="heading-link" href="#nat-in-kernel-on-ipfw">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Add entry to the NAT table:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ipfw nat nat_number config nat_config
</span></span></code></pre></div><p>, where nat_number is instance number on the NAT table and nat_config can be:</p>
<ul>
<li>ip <em>ip_address</em>: specify address to be used for translation</li>
<li>if <em>nic</em>: use address of card <em>nic</em>, even if it changes dynamically</li>
<li>same_ports: try to not change the ports</li>
<li>reset: resets the table if addresses change</li>
<li>deny_in: denies all incoming traffic</li>
<li>redirect_addr <em>localIP</em> <em>publicIP</em>: translate <em>publicIP</em> to <em>localIP</em> and vice versa</li>
<li>redirect_proto <em>proto</em> <em>localIP</em> [publicIP [remoteIP]]: same but for protocol <em>proto</em></li>
<li>redirect_port <em>proto</em> <em>targetIP:targetPort</em> [<em>aliasIP:</em>]<em>aliasPort</em> [<em>remoteIP</em>[:<em>remotePort</em>]]: basically port forwarding</li>
</ul>
<p>Show all NAT tables:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ipfw nat show config
</span></span></code></pre></div><h3 id="examples-1">
  Examples
  <a class="heading-link" href="#examples-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ipfw add 100 deny ip from 1.2.3.0/24 to me
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ipfw add 200 allow tcp from me to any keep-state
</span></span></code></pre></div><p>Create an in-kernel NAT table with instance number 123 so that packets forwarded to it (matched by the corresponding ipfw rule) have their addresses translated to the address of interface em0, they reset when addresses change and traffic going to 172.16.16.2 (em0) is translated to 192.168.1.3. Then attach this table to ipfw rule 100:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ipfw nat 123 config if em0 reset redirect_addr 192.168.1.3 172.16.16.2
</span></span><span style="display:flex;"><span>$ ipfw add 100 nat 123 all from any to any
</span></span></code></pre></div><hr>
<h2 id="introduction-to-the-quagga-shell">
  Introduction to the Quagga Shell
  <a class="heading-link" href="#introduction-to-the-quagga-shell">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Mode</th>
<th style="text-align:center">Command</th>
<th style="text-align:center">Run it from</th>
<th style="text-align:center">Prompt</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Priviledged mode</td>
<td style="text-align:center"><code>$ vtysh</code></td>
<td style="text-align:center">FreeBSD Shell</td>
<td style="text-align:center"><code>#</code></td>
</tr>
<tr>
<td style="text-align:center">Configuration mode</td>
<td style="text-align:center"><code># con t</code></td>
<td style="text-align:center">Priviledged Shell</td>
<td style="text-align:center"><code>(config)#</code></td>
</tr>
<tr>
<td style="text-align:center">Interface Configuration mode</td>
<td style="text-align:center"><code>(config)# int &lt;interface&gt;</code></td>
<td style="text-align:center">Configuration Shell</td>
<td style="text-align:center"><code>(config-if)#</code></td>
</tr>
<tr>
<td style="text-align:center">Router Configuration mode</td>
<td style="text-align:center"><code>(config)# router &lt;router&gt;</code></td>
<td style="text-align:center">Configuration Shell</td>
<td style="text-align:center"><code>(config-router)#</code></td>
</tr>
</tbody>
</table>
<p>To run a command that needs to be run in Priviledged mode, but through another prompt, prepend <code>do</code> to your command.</p>
<p>To exit a mode and return to the previous at any time, run <code>exit</code> or <code>ex</code>, or just hit <code>Ctrl+Z</code>.</p>
<p>To cancel a command, re-write it and prepend <code>no</code>.</p>
<p>To see all running configurations, run <code>sh run</code>.</p>
<p>Get help for command syntax with <code>?</code> at any time.</p>
<p>You can run quagga commands from the shell directly with <code>vtysh -c &quot;my_command&quot;</code>.</p>
<p>Save configuration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># wr mem
</span></span></code></pre></div><h3 id="basic-interface-configuration">
  Basic interface configuration
  <a class="heading-link" href="#basic-interface-configuration">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Enter interface configuration mode for em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# int em0
</span></span></code></pre></div><p>Assign static address 192.168.1.1</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-if)# ip addr 192.168.1.1
</span></span></code></pre></div><p>Shutdown interface:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-if)# shutdown
</span></span></code></pre></div><p>Watch for changes in interface status:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-if)# link-detect
</span></span></code></pre></div><h3 id="static-routing-with-quagga">
  Static routing with Quagga
  <a class="heading-link" href="#static-routing-with-quagga">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Enable packet forwarding:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# ip forwarding
</span></span></code></pre></div><p>Add static route to 192.168.1.0/24 via 192.168.1.1 with administrative distance 1 (optional):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# ip route 192.168.1.0/24 192.168.1.1 1
</span></span></code></pre></div><hr>
<h2 id="rip-protocol">
  RIP Protocol
  <a class="heading-link" href="#rip-protocol">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Enable RIP and enter router configuration mode for RIP:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# router rip
</span></span></code></pre></div><p>Enable RIP on all interfaces that belong to the network with IP address 192.168.1.0/24:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# net 192.168.1.0/24
</span></span></code></pre></div><p>Enable RIP on interface em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# net em0
</span></span></code></pre></div><p>Set em0 to be a passive interface (does not send RIP updates):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# passive-interface em0
</span></span></code></pre></div><p>Set RIP protocol version number (1 or 2):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# version 1 (or 2)
</span></span></code></pre></div><p>Specify neighbor to unicast updates (important: RIPv2 by default RIP multicasts its updates through all associated interfaces, so this command must be combined with &ldquo;passive-interface&rdquo; to avoid sending simultaneously unicasts and multicasts)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# neighbor 172.17.17.10
</span></span></code></pre></div><p>Change timers</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# timers basic &lt;update&gt; &lt;timeout&gt; &lt;garbage&gt;
</span></span></code></pre></div><p>See RIP status</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># sh ip rip status
</span></span></code></pre></div><hr>
<h2 id="ospf-protocol">
  OSPF Protocol
  <a class="heading-link" href="#ospf-protocol">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="enable">
  Enable
  <a class="heading-link" href="#enable">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Enter router configuration mode for OSPF:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# router ospf
</span></span></code></pre></div><p>Set router ID to 1.1.1.1:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# router-id 1.1.1.1
</span></span></code></pre></div><h3 id="configuration">
  Configuration
  <a class="heading-link" href="#configuration">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Enable OSPF on interfaces that belong in the network 192.168.0.0/16 and relate them to area 1 (area 0 is the backbone):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# network 192.168.0.0/16 area 1
</span></span></code></pre></div><p>Set interface em0 to be a passive interface (does not send OSPF advertisements):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# passive-interface em0
</span></span></code></pre></div><p>Specify that area 1 is of type stub (has only one router):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# area 1 stub
</span></span></code></pre></div><p>Specify network type (e.g. broadcast, point-to-point etc):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-if)# ospf network &lt;type&gt;
</span></span></code></pre></div><h3 id="information">
  Information
  <a class="heading-link" href="#information">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Show OSPF general information and areas:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip ospf
</span></span></code></pre></div><p>Show OSPF information about interface em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip ospf interface em0
</span></span></code></pre></div><p>Show OSPF information about neighbors of interface em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip ospf neighbor em0
</span></span></code></pre></div><p>Display LSDB:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip ospf database
</span></span></code></pre></div><p>Display information for a specific type of LSA (e.g. router, network, summary etc):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip ospf database &lt;type&gt;
</span></span></code></pre></div><p>Show OSPF routing table:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip ospf route
</span></span></code></pre></div><p>Show ABRs:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip ospf border-routers
</span></span></code></pre></div><hr>
<h2 id="bgp-protocol">
  BGP Protocol
  <a class="heading-link" href="#bgp-protocol">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="enable-1">
  Enable
  <a class="heading-link" href="#enable-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Enter router configuration mode for bgp, in AS (autonomous system) 65010</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# router bgp 65010
</span></span></code></pre></div><h3 id="configuration-1">
  Configuration
  <a class="heading-link" href="#configuration-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Add network 192.168.0.0/16 to be advertised by BGP (does not activate bgp) on corresponding interfaces:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# network 192.168.0.0/16
</span></span></code></pre></div><p>Add router with IP 172.17.17.1 in list of BGP neighbors in AS 65020:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# neighbor 172.17.17.1 remote-as 65020
</span></span></code></pre></div><p>Set the IP address 172.17.17.1 as router ID:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# bgp router-id 172.17.17.1
</span></span></code></pre></div><p>Announce static/connected/rip/ospf routes respectively:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# redistribute static/connected/rip/ospf
</span></span></code></pre></div><p>Aggregate network prefixes to reduce the size of BGP routing table:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# aggregate-address
</span></span></code></pre></div><h3 id="information-1">
  Information
  <a class="heading-link" href="#information-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Show general info that BGP has learned:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip bgp 
</span></span></code></pre></div><p>&hellip;or a short summary of them:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip bgp summary
</span></span></code></pre></div><p>Show BGP path information for network 10.0.2.1:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip bgp 10.0.2.1
</span></span></code></pre></div><p>Show info for BGP neighbors:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip bgp neighbors
</span></span></code></pre></div><p>Show info for neighbor 172.17.17.1:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip bgp neighbors 172.17.17.1 
</span></span></code></pre></div><p>Show advertised routes to neighbor 172.17.17.1:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip bgp neighbors 172.17.17.1 advertised-routes 
</span></span></code></pre></div><p>Show routes that BGP learns from neighbor 172.17.17.1:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># show ip bgp neighbors 172.17.17.1 routes 
</span></span></code></pre></div><h3 id="applying-policies">
  Applying policies
  <a class="heading-link" href="#applying-policies">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Create a filter (prefix list) of permitted (permit) or denied (deny) prefixes with name PrefixListName:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# ip prefix-list PrefixListName permit/deny prefix 
</span></span></code></pre></div><p>Apply prefix list with name PrefixListName to neighbor 172.18.0.1 to incoming (in) or outgoing (out) traffic:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# neighbor 172.18.0.1 prefix-list PrefixListName in/out 
</span></span></code></pre></div><p>Create a route map and define order=100 (sequence to insert to/delete from existing route-map entry):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# route-map RouteMapName permit/deny 100
</span></span></code></pre></div><p>Apply route map in neighbor 172.17.17.1 to incoming (in) or outgoing (out) traffic:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# neighbor 172.17.17.1 route-map RouteMapName in/out 
</span></span></code></pre></div><hr>
<h2 id="ipv6">
  IPv6
  <a class="heading-link" href="#ipv6">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="general-shell">
  General (Shell)
  <a class="heading-link" href="#general-shell">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>To enable ipv6 on em0 and accept Router Advertisement messages:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ sysrc ifconfig_em0_ipv6=&#34;inet6 accept_rtadv&#34;
</span></span></code></pre></div><p>Assign ipv6 address fd00:1::2/64 to interface em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ifconfig em0 inet6 fd00:1::2/64
</span></span></code></pre></div><p>Show routing table:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ netstat -r6
</span></span></code></pre></div><p>Show ndp table (Neighbor Discovery Protocol - Substitute for ARP)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ ndp -a
</span></span></code></pre></div><p>Add as default gateway the host fd00:1::1 :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ route -6 add default fd00:1::1
</span></span></code></pre></div><h3 id="routing-quagga">
  Routing (Quagga)
  <a class="heading-link" href="#routing-quagga">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Enable daemons for ipv6:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>$ service quagga stop
</span></span><span style="display:flex;"><span>$ touch /usr/local/etc/quagga/ripngd.conf
</span></span><span style="display:flex;"><span>$ chown quagga:quagga /usr/local/etc/quagga/ripngd.conf
</span></span><span style="display:flex;"><span>$ touch /usr/local/etc/quagga/ospf6d.conf
</span></span><span style="display:flex;"><span>$ chown quagga:quagga /usr/local/etc/quagga/ospf6d.conf
</span></span><span style="display:flex;"><span>$ sysrc quagga_daemons=&#34;zebra ripd ripngd ospfd opdf6d bgpd&#34;
</span></span><span style="display:flex;"><span>$ service quagga start
</span></span></code></pre></div><p>Assign address fd00:1::1/64 to an interface:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-if)# ipv6 a fd00:1::1/64
</span></span></code></pre></div><p>Show routing table for ipv6:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># sh ipv6 route
</span></span></code></pre></div><h4 id="static">
  Static
  <a class="heading-link" href="#static">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<p>Add static route to network fd00:2::/64 through fd00:3::2</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# ipv6 route fd00:2::/64 fd00:3::2
</span></span></code></pre></div><h4 id="dynamic">
  Dynamic
  <a class="heading-link" href="#dynamic">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<h5 id="rip">
  RIP
  <a class="heading-link" href="#rip">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h5>
<p>Enter router configuration mode for ripng:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# router ripng
</span></span></code></pre></div><p>Enable RIP for ipv6 on interface em0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# net em0
</span></span></code></pre></div><h5 id="ospf">
  OSPF
  <a class="heading-link" href="#ospf">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h5>
<p>Enter router configuration mode for BGP:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# router ospf6
</span></span></code></pre></div><p>Specify 1.1.1.1 as router ID:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-ospf6)# router-id 1.1.1.1
</span></span></code></pre></div><p>Activate ospf on interface em0 in area 0.0.0.0:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-ospf6)# int em0 area 0.0.0.0
</span></span></code></pre></div><h5 id="bgp">
  BGP
  <a class="heading-link" href="#bgp">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h5>
<p>Enter router configuration mode for BGP declaring autonomous system (AS) 65010</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config)# router bgp 65010
</span></span></code></pre></div><p>Set router ID 1.1.1.1:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# bgp router-id 1.1.1.1
</span></span></code></pre></div><p>Disable IPv4 unicast for neighbor establishment (do this only if you use entirelly IPv6 addresses)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# no bgp default ipv4-unicast
</span></span></code></pre></div><p>Declare router with address fd00:3::2 as neighbor in AS 65020:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# neighbor fd00:3::2 remote-as 65020
</span></span></code></pre></div><p>Enter submenu for address family IPv6:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router)# address-family ipv6
</span></span></code></pre></div><p>Advertise network fd00:2::/64</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router-af)# net fd00:1::/64
</span></span></code></pre></div><p>Enable neighbor relation with fd00:3::2 :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>(config-router-af)# neighbor fd00:3::2 activate
</span></span></code></pre></div><hr>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        Â©
        
          2018 -
        
        2024
        
      
      
      
    </section>
  </footer>


    </main>

    
      
      <script src="/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js" integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script>
    

    
      <script src="/js/custom.js"></script>
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    
      <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/highlight.min.js"></script>
    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-122370931-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    

    

    

    

    

    
  </body>

</html>
